import{b as Ne,u as ve,a as we,r as n,j as e}from"./index-DdyBZTvh.js";import{a as v}from"./index-ngrFHoWO.js";import{F as ke,z as s}from"./index-EqqdN_zE.js";import{c as z}from"./createLucideIcon--6vGHxH9.js";import{U as De}from"./upload-WcW3Z81Y.js";/**
 * @license lucide-react v0.546.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Pe=z("circle-check-big",Ce);/**
 * @license lucide-react v0.546.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]],Se=z("credit-card",Te);/**
 * @license lucide-react v0.546.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],_e=z("shield-check",Me),Oe=()=>{const{id:m}=Ne(),f=ve(),c=we(),h=new URLSearchParams(c.search),P=h.get("city"),g=h.get("pickupDate"),x=h.get("dropoffDate"),T=h.get("pickupTime")||"00:00",S=h.get("dropoffTime")||"00:00",[a,F]=n.useState({userId:"123",name:"",email:"",phoneNumber:"",aadhaarDocument:null,licenseDocument:null}),[O,K]=n.useState(""),[E,Q]=n.useState(!1),[u,X]=n.useState(!1),[B,L]=n.useState(!1),[w,R]=n.useState(0),[A,M]=n.useState(!1),[o,ee]=n.useState(null),[te,ae]=n.useState(!0),[H,se]=n.useState(!1);n.useEffect(()=>{(async()=>{try{const r=await v.get(`https://rental-platform-0o9d.onrender.com/api/vehicles/${m}`);ee(r.data)}catch(r){console.error("Error fetching vehicle:",r),s.error("Failed to load vehicle details.")}finally{ae(!1)}})()},[m]);const re=(t,r,l,d,y)=>{const p=(C,be)=>{if(!C)return null;const W=be||"00:00",je=`${C}T${W}:00`,Y=new Date(je);return isNaN(Y)?new Date(`${C} ${W}`):Y},b=p(r,l),k=p(d,y);if(!b||!k||isNaN(b)||isNaN(k)||k<=b)return{chargedDays:0,chargedHours:0,subtotal:0,taxes:0,handling:10,total:10,note:"Invalid dates/times"};const ge=k.getTime()-b.getTime(),$=Math.floor(ge/(1e3*60)),I=1440,xe=Math.floor($/I),V=$%I,fe=t/24;let j=xe,N=0,i=0,D="";if($<=I)return i=Math.round(t),{chargedDays:1,chargedHours:N,subtotal:i,taxes:Math.round(i*.1),handling:10,total:i+Math.round(i*.1)+10,note:"Minimum 24-hour price applied"};V===0?(i=Math.round(t*j),D="Exact full days"):V>720?(j++,i=Math.round(t*j),D="Remainder > 12 hours, charged as an extra full day"):(N=Math.ceil(V/60),i=Math.round(t*j+fe*N),D=`Charged ${N} extra hour(s)`);const J=Math.round(i*.18),ye=Math.round(i+J+10);return{chargedDays:j,chargedHours:N,subtotal:i,taxes:J,handling:10,total:ye,note:D}},ne=n.useMemo(()=>o?re(Number(o.rentPerDay)||0,g,T,x,S):{chargedDays:0,chargedHours:0,subtotal:0,taxes:0,handling:10,total:10,note:""},[o,g,T,x,S]),_=t=>F({...a,[t.target.name]:t.target.value}),U=t=>{const{name:r,files:l}=t.target,d=l[0];if(d){if(d.size>4*1024*1024)return s.error("File too large (max 4MB)");if(!["image/jpeg","image/png","image/webp"].includes(d.type))return s.error("Invalid file type (JPG, PNG, JPEG only)");F({...a,[r]:d})}},oe=async()=>{if(!a.phoneNumber)return s.error("Enter phone number first");if(!(w>0)){L(!0);try{await v.post("https://rental-platform-0o9d.onrender.com/api/otp/send",{phoneNumber:a.phoneNumber}),s.success("OTP sent to SMS"),Q(!0),R(30);const t=setInterval(()=>{R(r=>r<=1?(clearInterval(t),0):r-1)},1e3)}catch{s.error("Failed to send OTP")}finally{L(!1)}}},ie=async()=>{try{(await v.post("https://rental-platform-0o9d.onrender.com/api/otp/verify",{phoneNumber:a.phoneNumber,otp:O})).data.success?(X(!0),s.success("Phone verified successfully")):s.error("Invalid OTP")}catch{s.error("OTP verification failed")}},le=()=>{const t=new FormData;return Object.entries(a).forEach(([r,l])=>l&&t.append(r,l)),t.append("vehicleId",m),t.append("city",P),t.append("pickupDate",g),t.append("dropoffDate",x),t},ce=async t=>{if(t.preventDefault(),o?.availableCount===0)return s.error("Vehicle not available");if(!u)return s.error("Verify phone number first");if(!H)return s.error("Please agree to the Terms & Conditions");M(!0);try{const{data:r}=await v.post("https://rental-platform-0o9d.onrender.com/api/payments/create-order",{pickupDate:g,dropoffDate:x,pricePerDay:o?.rentPerDay||500,userId:a.userId,vehicleId:m});if(!r.success)return s.error("Error creating payment order");if(!window.Razorpay){s.error("Payment service unavailable"),M(!1);return}const{order:l}=r,d={key:"rzp_live_RdZVBsVaZLWTME",amount:l.amount,currency:l.currency,name:"NewBikeWorld Rentals",description:"Booking Payment",order_id:l.id,handler:async y=>{try{const p=le();p.append("razorpay_order_id",y.razorpay_order_id),p.append("razorpay_payment_id",y.razorpay_payment_id),p.append("razorpay_signature",y.razorpay_signature),(await v.post("https://rental-platform-0o9d.onrender.com/api/payments/verify-payment",p,{headers:{"Content-Type":"multipart/form-data"}})).data?.success?(s.success("Booking successful!"),f("/booking-success",{state:{booking:{vehicleId:m,city:P,pickupDate:g,dropoffDate:x,name:a.name,phoneNumber:a.phoneNumber,email:a.email,vehicleName:c.state?.vehicleName,vehicleImage:c.state?.vehicleImage}}})):s.error("Payment verification failed")}catch{s.error("Error verifying payment")}},prefill:{name:a.name,email:a.email,contact:a.phoneNumber},theme:{color:"#0A3D62"}};new window.Razorpay(d).open()}catch{s.error("Payment initiation failed")}finally{M(!1)}},{chargedDays:de,chargedHours:q,subtotal:me,taxes:he,handling:ue,total:pe,note:G}=ne;return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-sky-100 flex justify-center items-start py-12 px-4",children:[e.jsx(ke,{position:"top-center"}),e.jsxs("div",{className:"flex flex-col lg:flex-row w-full max-w-6xl bg-white shadow-xl rounded-2xl overflow-hidden border border-blue-100",children:[e.jsxs("div",{className:"w-full lg:w-2/3 p-6 sm:p-8",children:[e.jsx("h2",{className:"text-3xl font-bold text-[#0A3D62] mb-6",children:"Complete Your Booking"}),e.jsxs("form",{onSubmit:ce,className:"space-y-4",children:[e.jsx("input",{type:"text",name:"name",value:a.name,onChange:_,placeholder:"Full Name",required:!0,className:"w-full border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-sky-400"}),e.jsx("input",{type:"email",name:"email",value:a.email,onChange:_,placeholder:"Email Address",required:!0,className:"w-full border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-sky-400"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx("input",{type:"tel",name:"phoneNumber",value:a.phoneNumber,onChange:_,required:!0,pattern:"[0-9]{10}",placeholder:"10-digit Phone Number",className:`w-full border rounded-lg p-3 ${u?"border-green-400 pr-10":"border-gray-300"}`}),u&&e.jsx(Pe,{className:"absolute right-3 top-3 text-green-600 w-5 h-5"})]}),e.jsx("button",{type:"button",onClick:oe,disabled:B||u||w>0,className:`px-4 py-3 rounded-lg font-medium text-white transition text-sm sm:text-base ${u?"bg-green-600 cursor-default":"bg-[#0A3D62] hover:bg-sky-700 disabled:opacity-60"}`,children:u?"âœ… Verified":B?"Sending...":w>0?`Resend in ${w}s`:E?"Resend OTP":"Send OTP"})]}),E&&!u&&e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsx("input",{type:"text",value:O,onChange:t=>K(t.target.value),placeholder:"Enter 6-digit OTP",className:"flex-1 border border-gray-300 rounded-lg p-3"}),e.jsx("button",{type:"button",onClick:ie,className:"bg-green-600 text-white px-4 rounded-lg hover:bg-green-700 transition",children:"Verify"})]}),e.jsx(Z,{label:"Upload ID Proof (Aadhaar / Passport)",name:"aadhaarDocument",file:a.aadhaarDocument,onChange:U}),e.jsx(Z,{label:"Upload Driverâ€™s License",name:"licenseDocument",file:a.licenseDocument,onChange:U}),e.jsxs("div",{className:"border rounded-lg p-3 bg-gray-50",children:[e.jsx("h4",{className:"font-semibold text-gray-700 mb-2",children:"Terms & Conditions"}),e.jsxs("ul",{className:"text-sm text-gray-600 list-disc list-inside space-y-1",children:[e.jsx("li",{children:"The renter must present a valid driving license at pickup."}),e.jsx("li",{children:"Fuel, traffic fines, and damages are the userâ€™s responsibility."}),e.jsx("li",{children:"Late returns beyond 1 hour will incur additional hourly charges."}),e.jsx("li",{children:"Vehicles must be returned in the same condition as rented."}),e.jsx("li",{children:"The actual color of the bike or scooter may vary from the images displayed on the website."}),e.jsx("li",{children:"Bookings once confirmed are non-refundable but can be rescheduled."})]}),e.jsxs("label",{className:"flex items-start mt-3 space-x-2 text-sm text-gray-700",children:[e.jsx("input",{type:"checkbox",checked:H,onChange:t=>se(t.target.checked),className:"mt-1"}),e.jsx("span",{children:"I have read and agree to the Terms & Conditions."})]})]}),e.jsx("button",{type:"submit",disabled:A,className:"w-full bg-gradient-to-r from-[#0A3D62] to-[#3DC1D3] text-white py-3 rounded-lg font-semibold hover:shadow-lg transition",children:A?"Processing...":"Proceed to Payment"}),e.jsxs("div",{className:"flex items-center justify-center mt-3 text-sm text-gray-600",children:[e.jsx(_e,{className:"w-4 h-4 mr-2 text-sky-600"})," ðŸ”’ Your payment is secure and encrypted"]}),e.jsxs("div",{className:"flex justify-center mt-1 space-x-2 opacity-70",children:[e.jsx("img",{src:"https://upload.wikimedia.org/wikipedia/commons/4/41/Visa_Logo.png",alt:"Visa",className:"h-4"}),e.jsx("img",{src:"https://upload.wikimedia.org/wikipedia/commons/0/04/Mastercard-logo.png",alt:"Mastercard",className:"h-4"}),e.jsx(Se,{className:"w-4 h-4 text-gray-500"})]})]})]}),e.jsxs("div",{className:"w-full lg:w-1/3 bg-gradient-to-b from-[#0A3D62] to-[#3DC1D3] text-white p-8 flex flex-col justify-between sticky top-10",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Booking Summary"}),te?e.jsx("div",{className:"w-full h-40 bg-white/20 rounded-lg animate-pulse"}):o?e.jsxs(e.Fragment,{children:[e.jsx("img",{loading:"lazy",decoding:"async",src:o.images?.[0]||"https://placehold.co/400x200?text=No+Image",alt:o.modelName,className:"rounded-lg mb-3 w-full h-40 object-contain bg-white/10 p-2"}),e.jsxs("p",{className:"font-bold text-lg",children:[o.brand," ",o.modelName]}),e.jsxs("p",{className:"text-sm text-white/80",children:["â‚¹",o.rentPerDay," / day"]})]}):e.jsx("div",{className:"w-full h-40 bg-white/20 rounded-lg flex items-center justify-center text-white/70",children:"Vehicle not found"}),e.jsxs("div",{className:"mt-3 text-sm space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Pickup:"})," ",P," on ",g," ",T]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Dropoff:"})," ",x," ",S]}),e.jsx("hr",{className:"my-3 border-white/30"}),e.jsxs("p",{children:["Days charged: ",e.jsx("span",{className:"float-right",children:de})]}),q>0&&e.jsxs("p",{children:["Extra hours charged: ",e.jsx("span",{className:"float-right",children:q})]}),e.jsxs("p",{className:"mt-2",children:["Subtotal: ",e.jsxs("span",{className:"float-right",children:["â‚¹",me]})]}),e.jsxs("p",{children:["Taxes & Fees (18%): ",e.jsxs("span",{className:"float-right",children:["â‚¹",he]})]}),e.jsxs("p",{children:["Handling Charges: ",e.jsxs("span",{className:"float-right",children:["â‚¹",ue]})]}),e.jsxs("p",{className:"font-semibold text-lg mt-2",children:["Total Payable: ",e.jsxs("span",{className:"float-right font-bold text-white",children:["â‚¹",pe]})]}),G&&e.jsx("p",{className:"text-xs mt-2 opacity-90",children:e.jsx("em",{children:G})})]})]}),e.jsxs("p",{className:"text-xs opacity-80 mt-6 text-center",children:["Need help? Contact us at ",e.jsx("strong",{children:"contact@newbikeworld.com"})]})]})]})]})},Z=({label:m,name:f,file:c,onChange:h})=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 mb-2 font-medium",children:m}),e.jsxs("label",{htmlFor:f,className:`flex items-center justify-between border-2 border-dashed rounded-lg p-3 cursor-pointer transition ${c?"border-green-400 bg-green-50 text-green-700":"border-blue-300 text-blue-700 hover:bg-blue-50"}`,children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(De,{className:`w-4 h-4 ${c?"text-green-600":"text-blue-600"}`}),e.jsx("span",{children:c?`âœ… ${c.name}`:"Upload File"})]}),e.jsx("input",{id:f,type:"file",name:f,accept:"image/jpeg, image/png, image/webp",onChange:h,className:"hidden",required:!0})]})]});export{Oe as default};
