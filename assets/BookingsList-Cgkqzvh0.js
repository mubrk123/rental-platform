import{r as n,j as e}from"./index-CEqPDHAW.js";import{a as c}from"./index-ngrFHoWO.js";import{z as r,F as $}from"./index-C2XAopq8.js";import{L as h}from"./loader-circle-4XyyydG9.js";import{c as i}from"./createLucideIcon-CbM2lbut.js";import{C as k}from"./cloud-upload-BA-JmLVY.js";import{C as P}from"./circle-check-DCvw2Jr7.js";/**
 * @license lucide-react v0.546.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]],E=i("clipboard-list",U);/**
 * @license lucide-react v0.546.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],A=i("download",L);/**
 * @license lucide-react v0.546.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["circle",{cx:"10",cy:"12",r:"2",key:"737tya"}],["path",{d:"m20 17-1.296-1.296a2.41 2.41 0 0 0-3.408 0L9 22",key:"wt3hpn"}]],S=i("file-image",H);/**
 * @license lucide-react v0.546.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],B=i("file-text",z),I=()=>{const[b,x]=n.useState([]),[w,N]=n.useState(!0),[u,f]=n.useState(null),[g,y]=n.useState(null),[v,p]=n.useState({}),l=n.useMemo(()=>({"x-admin-secret":"myadminsecret"}),[]),m=n.useCallback(async()=>{try{const s=((await c.get("https://rental-platform-0o9d.onrender.com/api/bookings",{headers:l})).data||[]).filter(o=>o.status?.toLowerCase()!=="completed");x(s);const a={};s.forEach(o=>{a[o._id]={photoUploaded:!!o.pickupPhoto,pdfDownloaded:!!o.pdfDownloaded}}),p(a)}catch(t){console.error("Error fetching bookings:",t),r.error("Failed to load bookings.")}finally{N(!1)}},[l]);n.useEffect(()=>{m()},[m]);const D=async t=>{const s=document.createElement("input");s.type="file",s.accept="image/*",s.click(),s.onchange=async a=>{const o=a.target.files[0];if(!o)return;const d=new FormData;d.append("pickupPhoto",o),f(t);const M=c.post(`https://rental-platform-0o9d.onrender.com/api/bookings/${t}/upload-pickup-photo`,d,{headers:{...l,"Content-Type":"multipart/form-data"}}).then(C=>{if(C.data?.success)p(j=>({...j,[t]:{...j[t],photoUploaded:!0}})),r.success("Pickup photo uploaded successfully!");else throw new Error("Upload failed")}).catch(()=>r.error("Failed to upload pickup photo.")).finally(()=>{f(null)});await r.promise(M,{loading:"Uploading photo...",success:"Photo uploaded!",error:"Upload failed."}),m()}},F=async t=>{try{const s=`https://rental-platform-0o9d.onrender.com/api/bookings/pdf/booking/${t}?admin_secret=myadminsecret`;window.open(s,"_blank"),await c.put(`https://rental-platform-0o9d.onrender.com/api/bookings/${t}/mark-pdf-downloaded`,{},{headers:l}),p(a=>({...a,[t]:{...a[t],pdfDownloaded:!0}})),r.success("PDF downloaded successfully!")}catch(s){console.error("PDF download error:",s),r.error("Failed to download PDF.")}},_=async t=>{if(!window.confirm("Mark this booking as returned and remove it?"))return;y(t);const s=c.put(`https://rental-platform-0o9d.onrender.com/api/bookings/complete/${t}`).then(a=>{if(a.data?.success)x(o=>o.filter(d=>d._id!==t)),r.success("Booking marked as returned.");else throw new Error("Failed")}).catch(()=>r.error("Failed to complete booking.")).finally(()=>y(null));await r.promise(s,{loading:"Updating...",success:"Booking completed!",error:"Failed to update booking."})};return w?e.jsxs("div",{className:"flex justify-center items-center h-64 text-blue-700",children:[e.jsx(h,{className:"w-6 h-6 animate-spin mr-2"})," Loading bookings..."]}):e.jsxs("div",{className:"bg-white shadow-md rounded-lg p-6 border border-gray-200 relative",children:[e.jsx($,{position:"top-center",reverseOrder:!1}),e.jsxs("h2",{className:"text-2xl font-bold mb-4 flex items-center text-[#1E3A8A]",children:[e.jsx(E,{className:"w-6 h-6 mr-2 text-blue-700"})," Active Bookings"]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full border-collapse",children:[e.jsx("thead",{className:"bg-[#F8FAFC] text-gray-700 uppercase text-xs font-semibold",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 border-b text-left",children:"User"}),e.jsx("th",{className:"p-3 border-b text-left",children:"Dates"}),e.jsx("th",{className:"p-3 border-b text-center",children:"Documents"}),e.jsx("th",{className:"p-3 border-b text-center",children:"Status"}),e.jsx("th",{className:"p-3 border-b text-center",children:"Actions"})]})}),e.jsx("tbody",{children:b.map(t=>{const s=v[t._id]||{},a=s.photoUploaded,o=s.pdfDownloaded;return e.jsxs("tr",{className:"hover:bg-sky-50 border-b",children:[e.jsxs("td",{className:"p-3",children:[e.jsx("div",{className:"font-semibold text-gray-800",children:t.name}),e.jsx("div",{className:"text-sm text-gray-500",children:t.phoneNumber}),e.jsx("div",{className:"text-xs text-gray-400",children:t.email})]}),e.jsxs("td",{className:"p-3 text-sm text-gray-700",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-blue-700",children:"Pickup:"})," ",t.pickupDate?.slice(0,10)]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-blue-700",children:"Dropoff:"})," ",t.dropoffDate?.slice(0,10)]})]}),e.jsxs("td",{className:"p-3 text-center space-y-1",children:[t.aadhaarDocument?e.jsxs("a",{href:t.aadhaarDocument,target:"_blank",className:"text-blue-600 hover:text-blue-800 underline text-sm",children:[e.jsx(S,{className:"inline w-4 h-4 mr-1"})," Aadhaar"]}):e.jsx("span",{className:"text-gray-400 text-sm",children:"No Aadhaar"}),t.licenseDocument?e.jsxs("a",{href:t.licenseDocument,target:"_blank",className:"block text-blue-600 hover:text-blue-800 underline text-sm",children:[e.jsx(B,{className:"inline w-4 h-4 mr-1"})," License"]}):e.jsx("span",{className:"text-gray-400 text-sm",children:"No License"})]}),e.jsx("td",{className:"p-3 text-center",children:e.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-semibold bg-[#E0F2FE] text-[#0284C7]",children:"Active"})}),e.jsxs("td",{className:"p-3 text-center space-y-2",children:[e.jsx("button",{onClick:()=>D(t._id),disabled:u===t._id,className:`${a?"bg-green-600 hover:bg-green-700":"bg-indigo-600 hover:bg-indigo-700"} text-white px-3 py-1 rounded-md flex items-center justify-center w-full`,children:u===t._id?e.jsx(h,{className:"w-4 h-4 animate-spin"}):a?e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"w-4 h-4 mr-1"})," Upload Again"]}):e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"w-4 h-4 mr-1"})," Upload Pickup"]})}),e.jsxs("button",{onClick:()=>F(t._id),disabled:!a,className:`${a?"bg-blue-700 hover:bg-blue-800":"bg-gray-400 cursor-not-allowed"} text-white px-3 py-1 rounded-md flex items-center justify-center w-full`,children:[e.jsx(A,{className:"w-4 h-4 mr-1"}),o?"Download Again":"Download PDF"]}),e.jsx("button",{onClick:()=>_(t._id),disabled:!a||!o||g===t._id,className:`bg-green-600 text-white px-3 py-1 rounded-md flex items-center justify-center w-full ${!a||!o?"opacity-60 cursor-not-allowed":"hover:bg-green-700"}`,children:g===t._id?e.jsx(h,{className:"w-4 h-4 animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"w-4 h-4 mr-1"})," Mark Returned"]})})]})]},t._id)})})]})})]})};export{I as default};
