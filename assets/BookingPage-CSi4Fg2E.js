import{b as be,u as Ne,a as je,r as i,j as e}from"./index-Btv9iGSA.js";import{a as v}from"./index-ngrFHoWO.js";import{F as ve,z as r}from"./index-BhW5bzMy.js";import{c as I}from"./createLucideIcon-YgWYpsS-.js";import{U as we}from"./upload-B-yzhuEj.js";/**
 * @license lucide-react v0.546.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],De=I("circle-check-big",ke);/**
 * @license lucide-react v0.546.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]],Ce=I("credit-card",Pe);/**
 * @license lucide-react v0.546.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],Se=I("shield-check",Me),Ie=()=>{const{id:m}=be(),x=Ne(),c=je(),u=new URLSearchParams(c.search),C=u.get("city"),g=u.get("pickupDate"),f=u.get("dropoffDate"),M=u.get("pickupTime")||"00:00",S=u.get("dropoffTime")||"00:00",[a,O]=i.useState({userId:"123",name:"",email:"",phoneNumber:"",aadhaarDocument:null,licenseDocument:null}),[V,X]=i.useState(""),[E,Z]=i.useState(!1),[h,K]=i.useState(!1),[R,B]=i.useState(!1),[w,H]=i.useState(0),[A,_]=i.useState(!1),[n,Q]=i.useState(null),[ee,te]=i.useState(!0);i.useEffect(()=>{(async()=>{try{const s=await v.get(`https://rental-platform-0o9d.onrender.com/api/vehicles/${m}`);Q(s.data)}catch(s){console.error("Error fetching vehicle:",s),r.error("Failed to load vehicle details.")}finally{te(!1)}})()},[m]);const ae=(t,s,l,d,y)=>{const p=(P,xe)=>{if(!P)return null;const G=xe||"00:00",ye=`${P}T${G}:00`,Y=new Date(ye);return isNaN(Y)?new Date(`${P} ${G}`):Y},b=p(s,l),k=p(d,y);if(!b||!k||isNaN(b)||isNaN(k)||k<=b)return{chargedDays:0,chargedHours:0,subtotal:0,taxes:0,handling:10,total:10,note:"Invalid dates/times"};const he=k.getTime()-b.getTime(),$=Math.floor(he/(1e3*60)),z=1440,pe=Math.floor($/z),F=$%z,ge=t/24;let N=pe,j=0,o=0,D="";if($<=z)return o=Math.round(t),{chargedDays:1,chargedHours:j,subtotal:o,taxes:Math.round(o*.1),handling:10,total:o+Math.round(o*.1)+10,note:"Minimum 24-hour price applied"};F===0?(o=Math.round(t*N),D="Exact full days"):F>720?(N++,o=Math.round(t*N),D="Remainder > 12 hours, charged as an extra full day"):(j=Math.ceil(F/60),o=Math.round(t*N+ge*j),D=`Charged ${j} extra hour(s)`);const W=Math.round(o*.1),fe=Math.round(o+W+10);return{chargedDays:N,chargedHours:j,subtotal:o,taxes:W,handling:10,total:fe,note:D}},re=i.useMemo(()=>n?ae(Number(n.rentPerDay)||0,g,M,f,S):{chargedDays:0,chargedHours:0,subtotal:0,taxes:0,handling:10,total:10,note:""},[n,g,M,f,S]),T=t=>O({...a,[t.target.name]:t.target.value}),L=t=>{const{name:s,files:l}=t.target,d=l[0];if(d){if(d.size>4*1024*1024)return r.error("File too large (max 4MB)");if(!["image/jpeg","image/png","application/pdf"].includes(d.type))return r.error("Invalid file type (JPG, PNG, or PDF only)");O({...a,[s]:d})}},se=async()=>{if(!a.phoneNumber)return r.error("Enter phone number first");if(!(w>0)){B(!0);try{await v.post("https://rental-platform-0o9d.onrender.com/api/otp/send",{phoneNumber:a.phoneNumber}),r.success("OTP sent to WhatsApp"),Z(!0),H(30);const t=setInterval(()=>{H(s=>s<=1?(clearInterval(t),0):s-1)},1e3)}catch{r.error("Failed to send OTP")}finally{B(!1)}}},ne=async()=>{try{(await v.post("https://rental-platform-0o9d.onrender.com/api/otp/verify",{phoneNumber:a.phoneNumber,otp:V})).data.success?(K(!0),r.success("Phone verified successfully")):r.error("Invalid OTP")}catch{r.error("OTP verification failed")}},oe=()=>{const t=new FormData;return Object.entries(a).forEach(([s,l])=>l&&t.append(s,l)),t.append("vehicleId",m),t.append("city",C),t.append("pickupDate",g),t.append("dropoffDate",f),t},ie=async t=>{if(t.preventDefault(),n?.availableCount===0)return r.error("Vehicle not available");if(!h)return r.error("Verify phone number first");_(!0);try{const{data:s}=await v.post("https://rental-platform-0o9d.onrender.com/api/payments/create-order",{pickupDate:g,dropoffDate:f,pricePerDay:n?.rentPerDay||500,userId:a.userId,vehicleId:m});if(!s.success)return r.error("Error creating payment order");if(!window.Razorpay){r.error("Payment service unavailable"),_(!1);return}const{order:l}=s,d={key:"rzp_test_RX2n8v9pWjMZko",amount:l.amount,currency:l.currency,name:"NewBikeWorld Rentals",description:"Booking Payment",order_id:l.id,handler:async y=>{try{const p=oe();p.append("razorpay_order_id",y.razorpay_order_id),p.append("razorpay_payment_id",y.razorpay_payment_id),p.append("razorpay_signature",y.razorpay_signature),(await v.post("https://rental-platform-0o9d.onrender.com/api/payments/verify-payment",p,{headers:{"Content-Type":"multipart/form-data"}})).data?.success?(r.success("Booking successful!"),x("/booking-success",{state:{booking:{vehicleId:m,city:C,pickupDate:g,dropoffDate:f,name:a.name,phoneNumber:a.phoneNumber,email:a.email,vehicleName:c.state?.vehicleName,vehicleImage:c.state?.vehicleImage}}})):r.error("Payment verification failed")}catch{r.error("Error verifying payment")}},prefill:{name:a.name,email:a.email,contact:a.phoneNumber},theme:{color:"#0A3D62"}};new window.Razorpay(d).open()}catch{r.error("Payment initiation failed")}finally{_(!1)}},{chargedDays:le,chargedHours:U,subtotal:ce,taxes:de,handling:me,total:ue,note:q}=re;return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-sky-100 flex justify-center items-start py-12 px-4",children:[e.jsx(ve,{position:"top-center"}),e.jsxs("div",{className:"flex flex-col lg:flex-row w-full max-w-6xl bg-white shadow-xl rounded-2xl overflow-hidden border border-blue-100",children:[e.jsxs("div",{className:"w-full lg:w-2/3 p-8",children:[e.jsx("h2",{className:"text-3xl font-bold text-[#0A3D62] mb-6",children:"Complete Your Booking"}),e.jsxs("form",{onSubmit:ie,className:"space-y-4",children:[e.jsx("input",{type:"text",name:"name",value:a.name,onChange:T,placeholder:"Full Name",required:!0,className:"w-full border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-sky-400"}),e.jsx("input",{type:"email",name:"email",value:a.email,onChange:T,placeholder:"Email Address",required:!0,className:"w-full border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-sky-400"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx("input",{type:"tel",name:"phoneNumber",value:a.phoneNumber,onChange:T,required:!0,pattern:"[0-9]{10}",placeholder:"10-digit Phone Number",className:`w-full border rounded-lg p-3 ${h?"border-green-400 pr-10":"border-gray-300"}`}),h&&e.jsx(De,{className:"absolute right-3 top-3 text-green-600 w-5 h-5"})]}),e.jsx("button",{type:"button",onClick:se,disabled:R||h||w>0,className:`px-4 rounded-lg font-medium text-white transition ${h?"bg-green-600 cursor-default":"bg-[#0A3D62] hover:bg-sky-700 disabled:opacity-60"}`,children:h?"âœ… Verified":R?"Sending...":w>0?`Resend in ${w}s`:E?"Resend OTP":"Send OTP"})]}),E&&!h&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:V,onChange:t=>X(t.target.value),placeholder:"Enter 6-digit OTP",className:"flex-1 border border-gray-300 rounded-lg p-3"}),e.jsx("button",{type:"button",onClick:ne,className:"bg-green-600 text-white px-4 rounded-lg hover:bg-green-700 transition",children:"Verify"})]}),e.jsx(J,{label:"Upload ID Proof (Aadhaar / Passport)",name:"aadhaarDocument",file:a.aadhaarDocument,onChange:L}),e.jsx(J,{label:"Upload Driverâ€™s License",name:"licenseDocument",file:a.licenseDocument,onChange:L}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2 italic",children:["âš ï¸ Please upload clear images only. Each file must be under ",e.jsx("strong",{children:"4 MB"}),"."]}),e.jsx("button",{type:"submit",disabled:A,className:"w-full bg-gradient-to-r from-[#0A3D62] to-[#3DC1D3] text-white py-3 rounded-lg font-semibold hover:shadow-lg transition",children:A?"Processing...":"Proceed to Payment"}),e.jsxs("div",{className:"flex items-center justify-center mt-3 text-sm text-gray-600",children:[e.jsx(Se,{className:"w-4 h-4 mr-2 text-sky-600"})," ðŸ”’ Your payment is secure and encrypted"]}),e.jsxs("div",{className:"flex justify-center mt-1 space-x-2 opacity-70",children:[e.jsx("img",{src:"https://upload.wikimedia.org/wikipedia/commons/4/41/Visa_Logo.png",alt:"Visa",className:"h-4"}),e.jsx("img",{src:"https://upload.wikimedia.org/wikipedia/commons/0/04/Mastercard-logo.png",alt:"Mastercard",className:"h-4"}),e.jsx(Ce,{className:"w-4 h-4 text-gray-500"})]})]})]}),e.jsxs("div",{className:"w-full lg:w-1/3 bg-gradient-to-b from-[#0A3D62] to-[#3DC1D3] text-white p-8 flex flex-col justify-between sticky top-10",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Booking Summary"}),ee?e.jsx("div",{className:"w-full h-40 bg-white/20 rounded-lg animate-pulse"}):n?e.jsxs(e.Fragment,{children:[e.jsx("img",{loading:"lazy",decoding:"async",src:n.images?.[0]||"https://placehold.co/400x200?text=No+Image",alt:n.modelName,className:"rounded-lg mb-3 w-full h-40 object-contain bg-white/10 p-2 transition-all duration-500 hover:scale-[1.02]"}),e.jsxs("p",{className:"font-bold text-lg",children:[n.brand," ",n.modelName]}),e.jsxs("p",{className:"text-sm text-white/80",children:["â‚¹",n.rentPerDay," / day"]})]}):e.jsx("div",{className:"w-full h-40 bg-white/20 rounded-lg flex items-center justify-center text-white/70",children:"Vehicle not found"}),e.jsxs("div",{className:"mt-3 text-sm space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Pickup:"})," ",C," on ",g," ",M]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Dropoff:"})," ",f," ",S]}),e.jsx("hr",{className:"my-3 border-white/30"}),e.jsxs("p",{children:["Days charged: ",e.jsx("span",{className:"float-right",children:le})]}),U>0&&e.jsxs("p",{children:["Extra hours charged: ",e.jsx("span",{className:"float-right",children:U})]}),e.jsxs("p",{className:"mt-2",children:["Subtotal: ",e.jsxs("span",{className:"float-right",children:["â‚¹",ce]})]}),e.jsxs("p",{children:["Taxes & Fees (10%): ",e.jsxs("span",{className:"float-right",children:["â‚¹",de]})]}),e.jsxs("p",{children:["Handling Charges: ",e.jsxs("span",{className:"float-right",children:["â‚¹",me]})]}),e.jsxs("p",{className:"font-semibold text-lg mt-2",children:["Total Payable: ",e.jsxs("span",{className:"float-right font-bold text-white",children:["â‚¹",ue]})]}),q&&e.jsx("p",{className:"text-xs mt-2 opacity-90",children:e.jsx("em",{children:q})})]})]}),e.jsxs("p",{className:"text-xs opacity-80 mt-6 text-center",children:["Need help? Contact us at ",e.jsx("strong",{children:"contact@newbikeworld.com"})]})]})]})]})},J=({label:m,name:x,file:c,onChange:u})=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 mb-2 font-medium",children:m}),e.jsxs("label",{htmlFor:x,className:`flex items-center justify-between border-2 border-dashed rounded-lg p-3 cursor-pointer transition ${c?"border-green-400 bg-green-50 text-green-700":"border-blue-300 text-blue-700 hover:bg-blue-50"}`,children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(we,{className:`w-4 h-4 ${c?"text-green-600":"text-blue-600"}`}),e.jsx("span",{children:c?`âœ… ${c.name}`:"Upload File"})]}),e.jsx("input",{id:x,type:"file",name:x,accept:"image/*,.pdf",onChange:u,className:"hidden",required:!0})]})]});export{Ie as default};
