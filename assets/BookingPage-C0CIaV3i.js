import{b as Se,u as Ce,a as ke,r as n,j as e}from"./index-CVkU3-IN.js";import{a as N}from"./index-ngrFHoWO.js";import{F as Te,z as s}from"./index-8H5jnDWT.js";import{c as Pe}from"./createLucideIcon-CDKwB0fI.js";import{U as Fe}from"./upload-Q9VE104E.js";/**
 * @license lucide-react v0.546.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Ve=Pe("circle-check-big",Me),ze=()=>{const{id:d}=Se(),b=Ce(),u=ke(),m=new URLSearchParams(u.search),k=m.get("city"),g=m.get("pickupDate"),x=m.get("dropoffDate"),T=m.get("pickupTime")||"00:00",P=m.get("dropoffTime")||"00:00",[a,_]=n.useState({userId:"123",name:"",email:"",phoneNumber:"",aadhaarDocument:null,licenseDocument:null}),[O,Q]=n.useState(""),[X,ee]=n.useState(!1),[f,te]=n.useState(!1),[$,z]=n.useState(!1),[v,A]=n.useState(0),[B,E]=n.useState(!1),[i,ae]=n.useState(null),[se,re]=n.useState(!0),[L,ne]=n.useState(!1),[c,le]=n.useState(1);n.useEffect(()=>{(async()=>{try{const r=await N.get(`https://rental-platform-0o9d.onrender.com/api/vehicles/${d}`);ae(r.data)}catch{s.error("Failed to load vehicle details")}finally{re(!1)}})()},[d]);const oe=(t,r,l,h,y)=>{const p=(J,we)=>{if(!J)return null;const De=we||"00:00";return new Date(`${J}T${De}:00`)},w=p(r,l),M=p(h,y);if(!w||!M||M<=w)return{chargedDays:0,chargedHours:0,subtotal:0,taxes:0,handling:10,helmetCharge:0,helmetGST:0,total:10,note:"Invalid dates"};const ye=M-w,V=Math.floor(ye/6e4),H=1440,je=Math.floor(V/H),I=V%H,Ne=t/24;let j=je,D=0,o=0,S="";if(V<=H)return o=t,{chargedDays:1,chargedHours:0,subtotal:o,taxes:Math.round(o*.18),handling:10,helmetCharge:c===2?50:0,helmetGST:c===2?Math.round(50*.18):0,total:o+Math.round(o*.18)+10+(c===2?50:0)+(c===2?Math.round(50*.18):0),note:"Minimum 1-day price applied"};I===0?(o=t*j,S="Exact full days"):I>720?(j++,o=t*j,S="Remainder > 12 hrs → 1 full extra day"):(D=Math.ceil(I/60),o=t*j+Ne*D,S=`${D} extra hrs charged`);const W=Math.round(o*.18),Z=10,C=c===2?50:0,Y=C>0?Math.round(C*.18):0,ve=Math.round(o+W+Z+C+Y);return{chargedDays:j,chargedHours:D,subtotal:o,taxes:W,handling:Z,helmetCharge:C,helmetGST:Y,total:ve,note:S}},ie=n.useMemo(()=>i?oe(Number(i.rentPerDay),g,T,x,P):{chargedDays:0,chargedHours:0,subtotal:0,taxes:0,handling:10,helmetCharge:0,helmetGST:0,total:10},[i,g,T,x,P,c]),F=t=>_({...a,[t.target.name]:t.target.value}),R=t=>{const{name:r,files:l}=t.target;if(!l[0])return;const h=l[0];if(h.size>4*1024*1024)return s.error("Max file size 4MB");if(!["image/jpeg","image/png","image/webp"].includes(h.type))return s.error("Invalid file type");_({...a,[r]:h})},ce=async()=>{if(!a.phoneNumber)return s.error("Enter phone first");if(!(v>0)){z(!0);try{await N.post("https://rental-platform-0o9d.onrender.com/api/otp/send",{phoneNumber:a.phoneNumber}),s.success("OTP sent"),ee(!0),A(30);const t=setInterval(()=>{A(r=>r<=1?(clearInterval(t),0):r-1)},1e3)}catch{s.error("OTP failed")}finally{z(!1)}}},de=async()=>{try{(await N.post("https://rental-platform-0o9d.onrender.com/api/otp/verify",{phoneNumber:a.phoneNumber,otp:O})).data.success?(te(!0),s.success("Phone verified")):s.error("Invalid OTP")}catch{s.error("Verification failed")}},me=()=>{const t=new FormData;return Object.entries(a).forEach(([r,l])=>l&&t.append(r,l)),t.append("vehicleId",d),t.append("city",k),t.append("pickupDate",g),t.append("dropoffDate",x),t.append("helmetCount",c),t},he=async t=>{if(t.preventDefault(),i?.availableCount===0)return s.error("Vehicle not available");if(!f)return s.error("Verify phone first");if(!L)return s.error("Accept T&C");E(!0);try{const{data:r}=await N.post("https://rental-platform-0o9d.onrender.com/api/payments/create-order",{pickupDate:g,dropoffDate:x,pricePerDay:i?.rentPerDay,userId:a.userId,vehicleId:d,helmetCount:c});if(!r.success){s.error("Payment error");return}const{order:l}=r,h={key:"rzp_live_RdZVBsVaZLWTME",amount:l.amount,currency:l.currency,name:"NewBikeWorld Rentals",description:"Booking Payment",order_id:l.id,handler:async y=>{try{const p=me();p.append("razorpay_order_id",y.razorpay_order_id),p.append("razorpay_payment_id",y.razorpay_payment_id),p.append("razorpay_signature",y.razorpay_signature),(await N.post("https://rental-platform-0o9d.onrender.com/api/payments/verify-payment",p,{headers:{"Content-Type":"multipart/form-data"}})).data?.success?(s.success("Booking successful"),b("/booking-success",{state:{booking:{vehicleId:d,city:k,pickupDate:g,dropoffDate:x,name:a.name,phoneNumber:a.phoneNumber,email:a.email,helmetCount:c}}})):s.error("Payment failed")}catch{s.error("Verification failed")}},prefill:{name:a.name,email:a.email,contact:a.phoneNumber},theme:{color:"#0A3D62"}};new window.Razorpay(h).open()}catch{s.error("Payment start failed")}finally{E(!1)}},{chargedDays:pe,chargedHours:G,subtotal:ue,taxes:ge,handling:xe,helmetCharge:U,helmetGST:fe,total:be,note:q}=ie;return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-sky-100 flex justify-center items-start py-12 px-4",children:[e.jsx(Te,{position:"top-center"}),e.jsxs("div",{className:"flex flex-col lg:flex-row w-full max-w-6xl bg-white shadow-xl rounded-2xl overflow-hidden border border-blue-100",children:[e.jsxs("div",{className:"w-full lg:w-2/3 p-6 sm:p-8",children:[e.jsx("h2",{className:"text-3xl font-bold text-[#0A3D62] mb-6",children:"Complete Your Booking"}),e.jsxs("form",{onSubmit:he,className:"space-y-4",children:[e.jsx("input",{type:"text",name:"name",value:a.name,onChange:F,placeholder:"Full Name",required:!0,className:"w-full border border-gray-300 rounded-lg p-3"}),e.jsx("input",{type:"email",name:"email",value:a.email,onChange:F,placeholder:"Email Address",required:!0,className:"w-full border border-gray-300 rounded-lg p-3"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx("input",{type:"tel",name:"phoneNumber",value:a.phoneNumber,onChange:F,required:!0,pattern:"[0-9]{10}",placeholder:"Phone Number",className:`w-full border rounded-lg p-3 ${f?"border-green-400 pr-10":"border-gray-300"}`}),f&&e.jsx(Ve,{className:"absolute right-3 top-3 text-green-600 w-5 h-5"})]}),e.jsx("button",{type:"button",onClick:ce,disabled:$||f||v>0,className:"px-4 py-3 rounded-lg text-white bg-[#0A3D62]",children:f?"Verified":$?"Sending...":v>0?`Resend in ${v}s`:"Send OTP"})]}),X&&!f&&e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsx("input",{type:"text",value:O,onChange:t=>Q(t.target.value),placeholder:"Enter OTP",className:"flex-1 border border-gray-300 rounded-lg p-3"}),e.jsx("button",{type:"button",onClick:de,className:"px-4 bg-green-600 text-white rounded-lg",children:"Verify"})]}),e.jsx(K,{label:"Upload ID Proof (Aadhaar / Passport)",name:"aadhaarDocument",file:a.aadhaarDocument,onChange:R}),e.jsx(K,{label:"Upload Driving License",name:"licenseDocument",file:a.licenseDocument,onChange:R}),e.jsxs("div",{className:"border rounded-lg p-3 bg-gray-50",children:[e.jsx("h4",{className:"font-semibold text-gray-700 mb-2",children:"Helmet Options"}),e.jsxs("select",{value:c,onChange:t=>le(Number(t.target.value)),className:"w-full border border-gray-300 rounded-lg p-2",children:[e.jsx("option",{value:1,children:"1 Helmet (Free)"}),e.jsx("option",{value:2,children:"2 Helmets (+₹50 + GST)"})]}),e.jsxs("p",{className:"text-sm mt-2 text-gray-600",children:["First helmet is free. Second helmet costs ",e.jsx("strong",{children:"₹50 + 18% GST"}),"."]})]}),e.jsxs("div",{className:"border rounded-lg p-3 bg-gray-50",children:[e.jsx("h4",{className:"font-semibold text-gray-700 mb-2",children:"Terms & Conditions"}),e.jsxs("ul",{className:"text-sm list-disc list-inside text-gray-600 space-y-1",children:[e.jsx("li",{children:"Valid driving license must be shown."}),e.jsx("li",{children:"Fuel, fines & damages are customer responsibility."}),e.jsx("li",{children:"Late return incurs hourly charge."}),e.jsx("li",{children:"Return vehicle in same condition."}),e.jsx("li",{children:"Actual bike color may vary."}),e.jsx("li",{children:"Non-refundable bookings; rescheduling allowed."})]}),e.jsxs("label",{className:"flex items-start mt-3 space-x-2 text-sm text-gray-700",children:[e.jsx("input",{type:"checkbox",checked:L,onChange:t=>ne(t.target.checked)}),e.jsx("span",{children:"I agree to Terms & Conditions."})]})]}),e.jsx("button",{type:"submit",disabled:B,className:"w-full bg-[#0A3D62] text-white py-3 rounded-lg",children:B?"Processing...":"Proceed to Payment"})]})]}),e.jsxs("div",{className:"w-full lg:w-1/3 bg-gradient-to-b from-[#0A3D62] to-[#3DC1D3] text-white p-8 sticky top-10",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Booking Summary"}),se?e.jsx("div",{className:"w-full h-40 bg-white/20 rounded-lg animate-pulse"}):i?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:i.images?.[0],className:"rounded-lg mb-3 w-full h-40 object-contain bg-white/10 p-2"}),e.jsxs("p",{className:"font-bold text-lg",children:[i.brand," ",i.modelName]}),e.jsxs("p",{className:"text-sm text-white/80",children:["₹",i.rentPerDay," / day"]})]}):e.jsx("div",{children:"Vehicle not found"}),e.jsxs("div",{className:"mt-3 text-sm space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Pickup:"})," ",k," • ",g," ",T]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Dropoff:"})," ",x," ",P]}),e.jsx("hr",{className:"my-3 border-white/30"}),e.jsxs("p",{children:["Days charged: ",e.jsx("span",{className:"float-right",children:pe})]}),G>0&&e.jsxs("p",{children:["Extra Hours: ",e.jsx("span",{className:"float-right",children:G})]}),e.jsxs("p",{className:"mt-2",children:["Subtotal: ",e.jsxs("span",{className:"float-right",children:["₹",ue]})]}),e.jsxs("p",{children:["Taxes (18%): ",e.jsxs("span",{className:"float-right",children:["₹",ge]})]}),e.jsxs("p",{children:["Handling: ",e.jsxs("span",{className:"float-right",children:["₹",xe]})]}),U>0&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:["Helmet Charge: ",e.jsxs("span",{className:"float-right",children:["₹",U]})]}),e.jsxs("p",{children:["Helmet GST: ",e.jsxs("span",{className:"float-right",children:["₹",fe]})]})]}),e.jsxs("p",{className:"font-semibold text-lg mt-2",children:["Total Payable: ",e.jsxs("span",{className:"float-right font-bold text-white",children:["₹",be]})]}),q&&e.jsx("p",{className:"text-xs opacity-80 mt-2",children:e.jsx("em",{children:q})})]})]})]})]})},K=({label:d,name:b,file:u,onChange:m})=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 mb-2 font-medium",children:d}),e.jsxs("label",{htmlFor:b,className:`flex items-center justify-between border-2 border-dashed rounded-lg p-3 cursor-pointer ${u?"border-green-400 bg-green-50 text-green-700":"border-blue-300 text-blue-700"}`,children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Fe,{className:`w-4 h-4 ${u?"text-green-600":"text-blue-600"}`}),e.jsx("span",{children:u?`Uploaded: ${u.name}`:"Upload File"})]}),e.jsx("input",{id:b,type:"file",name:b,accept:"image/*",onChange:m,className:"hidden",required:!0})]})]});export{ze as default};
