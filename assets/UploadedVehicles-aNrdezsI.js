import{r,j as e}from"./index-DdyBZTvh.js";import{a as h}from"./index-ngrFHoWO.js";import{z as d,F as T}from"./index-EqqdN_zE.js";import{L as P}from"./loader-circle-5RUQVgot.js";import{c as j}from"./createLucideIcon--6vGHxH9.js";import{M as O}from"./map-pin-D2FOUUz2.js";import{G as q}from"./gauge-d5eizSfl.js";import{T as G}from"./trash-2-CY2Klsjq.js";import{X as _}from"./x-CG1bOJ9R.js";import{C as H}from"./cloud-upload-DCZ4DC2m.js";/**
 * @license lucide-react v0.546.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]],S=j("calendar-days",K);/**
 * @license lucide-react v0.546.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],J=j("funnel",X);/**
 * @license lucide-react v0.546.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],Y=j("pen",W),g=["All Locations","Lalbagh","NagaVara","Residency Road","Gandhi Nagar"],de=()=>{const[N,u]=r.useState([]),[w,c]=r.useState([]),[V,$]=r.useState(!0),[E,A]=r.useState("All Locations"),[l,y]=r.useState(null),[i,k]=r.useState({modelName:"",brand:"",rentPerDay:"",totalQuantity:"",city:g[1],type:"bike",kmLimitPerDay:""}),[F,v]=r.useState([]),[f,L]=r.useState([]),[o,x]=r.useState({open:!1,loading:!1,data:[],vehicle:null}),n=r.useMemo(()=>({"x-admin-secret":"myadminsecret"}),[]),D=r.useCallback(async()=>{try{const t=await h.get("https://rental-platform-0o9d.onrender.com/api/vehicles",{headers:n});u(t.data||[]),c(t.data||[])}catch(t){console.error("Error fetching vehicles:",t),d.error("Failed to load vehicles.")}finally{$(!1)}},[n]);r.useEffect(()=>{D()},[D]);const U=t=>{A(t),c(t==="All Locations"?N:N.filter(a=>a.city===t||a.location?.city===t))},z=async t=>{if(window.confirm("Delete this vehicle?"))try{await h.delete(`https://rental-platform-0o9d.onrender.com/api/vehicles/${t}`,{headers:n}),u(a=>a.filter(s=>s._id!==t)),c(a=>a.filter(s=>s._id!==t)),d.success("Vehicle deleted successfully!")}catch(a){console.error("Error deleting vehicle:",a),d.error("Failed to delete vehicle.")}},R=t=>{y(t),k({modelName:t.modelName,brand:t.brand,rentPerDay:t.rentPerDay,totalQuantity:t.totalQuantity,city:t.city||t.location?.city||g[1],type:t.type,kmLimitPerDay:t.kmLimitPerDay||150}),v([]),L(t.images||[])},p=t=>k({...i,[t.target.name]:t.target.value}),B=t=>{const a=Array.from(t.target.files);v(a),L([...f,...a.map(s=>URL.createObjectURL(s))])},I=async t=>{if(t.preventDefault(),!l)return;const a=new FormData;Object.entries(i).forEach(([s,C])=>a.append(s,C)),F.forEach(s=>a.append("images",s));try{if((await h.put(`https://rental-platform-0o9d.onrender.com/api/vehicles/${l._id}`,a,{headers:{...n,"Content-Type":"multipart/form-data"}})).data?.success){d.success("✅ Vehicle updated successfully!");const M=(await h.get(`https://rental-platform-0o9d.onrender.com/api/vehicles/${l._id}`,{headers:n})).data;u(b=>b.map(m=>m._id===l._id?M:m)),c(b=>b.map(m=>m._id===l._id?M:m)),y(null)}else d.error("❌ Update failed. Please try again.")}catch(s){console.error("Update error:",s),d.error("❌ Server error while updating.")}},Q=async t=>{x({open:!0,loading:!0,data:[],vehicle:t});try{const a=await h.get(`https://rental-platform-0o9d.onrender.com/api/bookings/upcoming/${t._id}`,{headers:n}),s=Array.isArray(a.data?.bookings)?a.data.bookings:a.data||[];x({open:!0,loading:!1,data:s,vehicle:t})}catch(a){console.error("Error fetching upcoming bookings:",a),x({open:!0,loading:!1,data:[],vehicle:t,error:!0})}};return V?e.jsxs("div",{className:"flex justify-center items-center min-h-[60vh] text-indigo-600",children:[e.jsx(P,{className:"animate-spin w-6 h-6 mr-2"})," Loading uploaded vehicles..."]}):e.jsxs("div",{className:"bg-white shadow-md rounded-lg p-6 relative",children:[e.jsx(T,{position:"top-center"}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-indigo-600 text-center sm:text-left mb-4 sm:mb-0",children:"Uploaded Vehicles"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(J,{className:"w-5 h-5 text-indigo-600"}),e.jsx("select",{value:E,onChange:t=>U(t.target.value),className:"border border-indigo-300 text-gray-700 rounded-lg p-2 focus:ring-2 focus:ring-indigo-500 focus:outline-none",children:g.map(t=>e.jsx("option",{children:t},t))})]})]}),w.length===0?e.jsx("p",{className:"text-center text-gray-500",children:"No vehicles found for this location."}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:w.map(t=>e.jsxs("div",{className:"border border-gray-200 rounded-xl overflow-hidden hover:shadow-lg transition-shadow bg-white",children:[e.jsx("img",{src:t.images?.[0]||"https://placehold.co/400x200?text=No+Image",alt:t.modelName,className:"w-full h-40 object-cover",loading:"lazy"}),e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"text-lg font-bold text-indigo-700 mb-1",children:t.modelName}),e.jsxs("p",{className:"text-sm text-gray-600 mb-1",children:[t.brand," • ",t.type]}),e.jsxs("p",{className:"flex items-center text-xs text-gray-500 mb-1",children:[e.jsx(O,{className:"w-4 h-4 mr-1 text-red-500"}),t.city||t.location?.city]}),e.jsxs("p",{className:"text-gray-700 text-sm font-semibold",children:["₹",t.rentPerDay," / day"]}),e.jsxs("p",{className:"text-xs text-gray-600 mt-1 flex items-center",children:[e.jsx(q,{className:"w-4 h-4 mr-1 text-sky-500"}),t.kmLimitPerDay?`${t.kmLimitPerDay} km/day`:"150 km/day"]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Available:"," ",e.jsx("span",{className:`font-bold ${t.availableCount>0?"text-green-600":"text-red-600"}`,children:t.availableCount})," ","/ ",t.totalQuantity]}),e.jsxs("button",{onClick:()=>Q(t),className:`mt-3 w-full bg-gradient-to-r from-indigo-500 to-purple-600 hover:from-purple-600 hover:to-indigo-500 
                             text-white py-2 rounded-lg text-sm font-medium flex justify-center items-center gap-2 transition-all`,children:[e.jsx(S,{className:"w-4 h-4"})," View Upcoming Bookings"]}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsxs("button",{onClick:()=>R(t),className:"w-1/2 bg-indigo-500 text-white py-2 rounded-md hover:bg-indigo-600 transition text-sm flex items-center justify-center",children:[e.jsx(Y,{className:"w-4 h-4 mr-1"})," Edit"]}),e.jsxs("button",{onClick:()=>z(t._id),className:"w-1/2 bg-red-500 text-white py-2 rounded-md hover:bg-red-600 transition text-sm flex items-center justify-center",children:[e.jsx(G,{className:"w-4 h-4 mr-1"})," Delete"]})]})]})]},t._id))}),o.open&&e.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-2xl relative p-6 max-h-[85vh] overflow-y-auto",children:[e.jsx("button",{onClick:()=>x({open:!1,data:[],vehicle:null}),className:"absolute top-3 right-3 text-gray-500 hover:text-gray-700",children:e.jsx(_,{className:"w-5 h-5"})}),e.jsxs("h2",{className:"text-xl font-bold text-indigo-700 mb-3 flex items-center gap-2",children:[e.jsx(S,{className:"w-5 h-5"}),"Upcoming Bookings —"," ",e.jsx("span",{className:"text-gray-700",children:o.vehicle?.modelName})]}),o.loading?e.jsxs("div",{className:"flex justify-center items-center py-10 text-indigo-600",children:[e.jsx(P,{className:"animate-spin w-5 h-5 mr-2"}),"Loading bookings..."]}):o.error?e.jsx("p",{className:"text-red-600 text-center",children:"Error loading bookings."}):o.data.length===0?e.jsx("p",{className:"text-center text-gray-500",children:"No upcoming bookings for this vehicle."}):e.jsx("div",{className:"space-y-2",children:o.data.map(t=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-3 shadow-sm flex justify-between items-center bg-indigo-50",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-indigo-700",children:t.name||"—"}),e.jsx("p",{className:"text-xs text-gray-600",children:t.phoneNumber||"No contact"})]}),e.jsxs("div",{className:"text-xs text-gray-700 text-right",children:[new Date(t.pickupDate).toLocaleDateString()," →"," ",new Date(t.dropoffDate).toLocaleDateString()]})]},t._id))})]})}),l&&e.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-lg relative p-6 max-h-[90vh] overflow-y-auto",children:[e.jsx("button",{onClick:()=>y(null),className:"absolute top-3 right-3 text-gray-500 hover:text-gray-700",children:e.jsx(_,{className:"w-5 h-5"})}),e.jsx("h2",{className:"text-2xl font-bold text-indigo-700 mb-4",children:"Edit Vehicle"}),e.jsxs("form",{onSubmit:I,className:"space-y-4",children:[[["Model Name","modelName","text"],["Brand","brand","text"],["Rent Per Day (₹)","rentPerDay","number"],["Total Quantity","totalQuantity","number"]].map(([t,a,s])=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:t}),e.jsx("input",{type:s,name:a,value:i[a],onChange:p,className:"border rounded-lg p-2 w-full",required:!0})]},a)),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"City"}),e.jsx("select",{name:"city",value:i.city,onChange:p,className:"border rounded-lg p-2 w-full",children:g.filter(t=>t!=="All Locations").map(t=>e.jsx("option",{children:t},t))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Type"}),e.jsxs("select",{name:"type",value:i.type,onChange:p,className:"border rounded-lg p-2 w-full",children:[e.jsx("option",{value:"bike",children:"Bike"}),e.jsx("option",{value:"scooter",children:"Scooter"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"KM Limit Per Day"}),e.jsx("input",{type:"number",name:"kmLimitPerDay",value:i.kmLimitPerDay,onChange:p,className:"border rounded-lg p-2 w-full",placeholder:"e.g. 150",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Upload Images (optional)"}),e.jsx("input",{type:"file",multiple:!0,accept:"image/*",onChange:B,className:"border rounded-lg p-2 w-full"})]}),f.length>0&&e.jsx("div",{className:"grid grid-cols-2 gap-3 mt-2",children:f.map((t,a)=>e.jsx("img",{src:t,alt:`preview-${a}`,className:"w-full h-28 object-cover rounded-md border"},a))}),e.jsxs("button",{type:"submit",className:"w-full bg-indigo-600 text-white py-2 rounded-lg hover:bg-indigo-700 flex items-center justify-center gap-2",children:[e.jsx(H,{className:"w-4 h-4"})," Save Changes"]})]})]})})]})};export{de as default};
