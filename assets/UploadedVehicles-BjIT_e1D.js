import{r,j as t}from"./index-CEqPDHAW.js";import{a as h}from"./index-ngrFHoWO.js";import{z as n,F as T}from"./index-C2XAopq8.js";import{L as M}from"./loader-circle-4XyyydG9.js";import{c as j}from"./createLucideIcon-CbM2lbut.js";import{M as O}from"./map-pin-xtlKUD_b.js";import{T as q}from"./trash-2-Dtyy-cQH.js";import{X as S}from"./x-DOa7XC-h.js";import{C as H}from"./cloud-upload-BA-JmLVY.js";/**
 * @license lucide-react v0.546.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]],V=j("calendar-days",G);/**
 * @license lucide-react v0.546.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],J=j("funnel",X);/**
 * @license lucide-react v0.546.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],W=j("pen",K),p=["All Locations","Lalbagh","NagaVara","Residency Road","Gandhi Nagar"],ie=()=>{const[N,g]=r.useState([]),[w,d]=r.useState([]),[E,$]=r.useState(!0),[A,F]=r.useState("All Locations"),[l,u]=r.useState(null),[c,v]=r.useState({modelName:"",brand:"",rentPerDay:"",totalQuantity:"",city:p[1],type:"bike"}),[U,k]=r.useState([]),[f,C]=r.useState([]),[o,x]=r.useState({open:!1,loading:!1,data:[],vehicle:null}),i=r.useMemo(()=>({"x-admin-secret":"myadminsecret"}),[]),L=r.useCallback(async()=>{try{const e=await h.get("https://rental-platform-0o9d.onrender.com/api/vehicles",{headers:i});g(e.data||[]),d(e.data||[])}catch(e){console.error("Error fetching vehicles:",e),n.error("Failed to load vehicles.")}finally{$(!1)}},[i]);r.useEffect(()=>{L()},[L]);const P=e=>{F(e),d(e==="All Locations"?N:N.filter(a=>a.city===e||a.location?.city===e))},z=async e=>{if(window.confirm("Delete this vehicle?"))try{await h.delete(`https://rental-platform-0o9d.onrender.com/api/vehicles/${e}`,{headers:i}),g(a=>a.filter(s=>s._id!==e)),d(a=>a.filter(s=>s._id!==e)),n.success("Vehicle deleted successfully!")}catch(a){console.error("Error deleting vehicle:",a),n.error("Failed to delete vehicle.")}},R=e=>{u(e),v({modelName:e.modelName,brand:e.brand,rentPerDay:e.rentPerDay,totalQuantity:e.totalQuantity,city:e.city||e.location?.city||p[1],type:e.type}),k([]),C(e.images||[])},y=e=>v({...c,[e.target.name]:e.target.value}),B=e=>{const a=Array.from(e.target.files);k(a),C([...f,...a.map(s=>URL.createObjectURL(s))])},I=async e=>{if(e.preventDefault(),!l)return;const a=new FormData;Object.entries(c).forEach(([s,D])=>a.append(s,D)),U.forEach(s=>a.append("images",s));try{if((await h.put(`https://rental-platform-0o9d.onrender.com/api/vehicles/${l._id}`,a,{headers:{...i,"Content-Type":"multipart/form-data"}})).data?.success){n.success("✅ Vehicle updated successfully!");const _=(await h.get(`https://rental-platform-0o9d.onrender.com/api/vehicles/${l._id}`,{headers:i})).data;g(b=>b.map(m=>m._id===l._id?_:m)),d(b=>b.map(m=>m._id===l._id?_:m)),u(null)}else n.error("❌ Update failed. Please try again.")}catch(s){console.error("Update error:",s),n.error("❌ Server error while updating.")}},Q=async e=>{x({open:!0,loading:!0,data:[],vehicle:e});try{const a=await h.get(`https://rental-platform-0o9d.onrender.com/api/bookings/upcoming/${e._id}`,{headers:i}),s=Array.isArray(a.data?.bookings)?a.data.bookings:a.data||[];x({open:!0,loading:!1,data:s,vehicle:e})}catch(a){console.error("Error fetching upcoming bookings:",a),x({open:!0,loading:!1,data:[],vehicle:e,error:!0})}};return E?t.jsxs("div",{className:"flex justify-center items-center min-h-[60vh] text-indigo-600",children:[t.jsx(M,{className:"animate-spin w-6 h-6 mr-2"})," Loading uploaded vehicles..."]}):t.jsxs("div",{className:"bg-white shadow-md rounded-lg p-6 relative",children:[t.jsx(T,{position:"top-center"}),t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6",children:[t.jsx("h2",{className:"text-2xl font-bold text-indigo-600 text-center sm:text-left mb-4 sm:mb-0",children:"Uploaded Vehicles"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(J,{className:"w-5 h-5 text-indigo-600"}),t.jsx("select",{value:A,onChange:e=>P(e.target.value),className:"border border-indigo-300 text-gray-700 rounded-lg p-2 focus:ring-2 focus:ring-indigo-500 focus:outline-none",children:p.map(e=>t.jsx("option",{children:e},e))})]})]}),w.length===0?t.jsx("p",{className:"text-center text-gray-500",children:"No vehicles found for this location."}):t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:w.map(e=>t.jsxs("div",{className:"border border-gray-200 rounded-xl overflow-hidden hover:shadow-lg transition-shadow bg-white",children:[t.jsx("img",{src:e.images?.[0]||"https://placehold.co/400x200?text=No+Image",alt:e.modelName,className:"w-full h-40 object-cover",loading:"lazy"}),t.jsxs("div",{className:"p-4",children:[t.jsx("h3",{className:"text-lg font-bold text-indigo-700 mb-1",children:e.modelName}),t.jsxs("p",{className:"text-sm text-gray-600 mb-1",children:[e.brand," • ",e.type]}),t.jsxs("p",{className:"flex items-center text-xs text-gray-500 mb-1",children:[t.jsx(O,{className:"w-4 h-4 mr-1 text-red-500"}),e.city||e.location?.city]}),t.jsxs("p",{className:"text-gray-700 text-sm font-semibold",children:["₹",e.rentPerDay," / day"]}),t.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Available:"," ",t.jsx("span",{className:`font-bold ${e.availableCount>0?"text-green-600":"text-red-600"}`,children:e.availableCount})," ","/ ",e.totalQuantity]}),t.jsxs("button",{onClick:()=>Q(e),className:`mt-3 w-full bg-gradient-to-r from-indigo-500 to-purple-600 hover:from-purple-600 hover:to-indigo-500 
                             text-white py-2 rounded-lg text-sm font-medium flex justify-center items-center gap-2 transition-all`,children:[t.jsx(V,{className:"w-4 h-4"})," View Upcoming Bookings"]}),t.jsxs("div",{className:"flex gap-2 mt-3",children:[t.jsxs("button",{onClick:()=>R(e),className:"w-1/2 bg-indigo-500 text-white py-2 rounded-md hover:bg-indigo-600 transition text-sm flex items-center justify-center",children:[t.jsx(W,{className:"w-4 h-4 mr-1"})," Edit"]}),t.jsxs("button",{onClick:()=>z(e._id),className:"w-1/2 bg-red-500 text-white py-2 rounded-md hover:bg-red-600 transition text-sm flex items-center justify-center",children:[t.jsx(q,{className:"w-4 h-4 mr-1"})," Delete"]})]})]})]},e._id))}),o.open&&t.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50 p-4",children:t.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-2xl relative p-6 max-h-[85vh] overflow-y-auto",children:[t.jsx("button",{onClick:()=>x({open:!1,data:[],vehicle:null}),className:"absolute top-3 right-3 text-gray-500 hover:text-gray-700",children:t.jsx(S,{className:"w-5 h-5"})}),t.jsxs("h2",{className:"text-xl font-bold text-indigo-700 mb-3 flex items-center gap-2",children:[t.jsx(V,{className:"w-5 h-5"}),"Upcoming Bookings —"," ",t.jsx("span",{className:"text-gray-700",children:o.vehicle?.modelName})]}),o.loading?t.jsxs("div",{className:"flex justify-center items-center py-10 text-indigo-600",children:[t.jsx(M,{className:"animate-spin w-5 h-5 mr-2"}),"Loading bookings..."]}):o.error?t.jsx("p",{className:"text-red-600 text-center",children:"Error loading bookings."}):o.data.length===0?t.jsx("p",{className:"text-center text-gray-500",children:"No upcoming bookings for this vehicle."}):t.jsx("div",{className:"space-y-2",children:o.data.map(e=>t.jsxs("div",{className:"border border-gray-200 rounded-lg p-3 shadow-sm flex justify-between items-center bg-indigo-50",children:[t.jsxs("div",{children:[t.jsx("p",{className:"font-semibold text-indigo-700",children:e.name||"—"}),t.jsx("p",{className:"text-xs text-gray-600",children:e.phoneNumber||"No contact"})]}),t.jsxs("div",{className:"text-xs text-gray-700 text-right",children:[new Date(e.pickupDate).toLocaleDateString()," →"," ",new Date(e.dropoffDate).toLocaleDateString()]})]},e._id))})]})}),l&&t.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50 p-4",children:t.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-lg relative p-6 max-h-[90vh] overflow-y-auto",children:[t.jsx("button",{onClick:()=>u(null),className:"absolute top-3 right-3 text-gray-500 hover:text-gray-700",children:t.jsx(S,{className:"w-5 h-5"})}),t.jsx("h2",{className:"text-2xl font-bold text-indigo-700 mb-4",children:"Edit Vehicle"}),t.jsxs("form",{onSubmit:I,className:"space-y-4",children:[[["Model Name","modelName","text"],["Brand","brand","text"],["Rent Per Day (₹)","rentPerDay","number"],["Total Quantity","totalQuantity","number"]].map(([e,a,s])=>t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:e}),t.jsx("input",{type:s,name:a,value:c[a],onChange:y,className:"border rounded-lg p-2 w-full",required:!0})]},a)),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"City"}),t.jsx("select",{name:"city",value:c.city,onChange:y,className:"border rounded-lg p-2 w-full",children:p.filter(e=>e!=="All Locations").map(e=>t.jsx("option",{children:e},e))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Type"}),t.jsxs("select",{name:"type",value:c.type,onChange:y,className:"border rounded-lg p-2 w-full",children:[t.jsx("option",{value:"bike",children:"Bike"}),t.jsx("option",{value:"scooter",children:"Scooter"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Upload Images (optional)"}),t.jsx("input",{type:"file",multiple:!0,accept:"image/*",onChange:B,className:"border rounded-lg p-2 w-full"})]}),f.length>0&&t.jsx("div",{className:"grid grid-cols-2 gap-3 mt-2",children:f.map((e,a)=>t.jsx("img",{src:e,alt:`preview-${a}`,className:"w-full h-28 object-cover rounded-md border"},a))}),t.jsxs("button",{type:"submit",className:"w-full bg-indigo-600 text-white py-2 rounded-lg hover:bg-indigo-700 flex items-center justify-center gap-2",children:[t.jsx(H,{className:"w-4 h-4"})," Save Changes"]})]})]})})]})};export{ie as default};
