import{r,j as e}from"./index-D-s7EsCP.js";import{a as u}from"./index-ngrFHoWO.js";import{z as m,F as I}from"./index-rO_hR2AE.js";import{L as S}from"./loader-circle-kZvG6ims.js";import{c as w}from"./createLucideIcon-CtJ9sfEf.js";import{M as q}from"./map-pin-CtKPa-hS.js";import{G as O}from"./gauge-BU5X-Mh5.js";import{T as G}from"./trash-2-BN4gaN-i.js";import{X as M}from"./x-DT3TJeZP.js";import{C as H}from"./cloud-upload-273Od8Kj.js";/**
 * @license lucide-react v0.546.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]],_=w("calendar-days",K);/**
 * @license lucide-react v0.546.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],J=w("funnel",X);/**
 * @license lucide-react v0.546.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],Y=w("pen",W),y=["All Locations","Lalbagh","NagaVara","Residency Road","Gandhi Nagar"],de=()=>{const[k,f]=r.useState([]),[v,h]=r.useState([]),[V,$]=r.useState(!0),[A,E]=r.useState("All Locations"),[o,b]=r.useState(null),[l,p]=r.useState({modelName:"",brand:"",rentPerDay:"",totalQuantity:"",city:y[1],type:"bike",kmLimitPerDay:""}),[F,D]=r.useState([]),[j,L]=r.useState([]),[d,g]=r.useState({open:!1,loading:!1,data:[],vehicle:null}),c=r.useMemo(()=>({Authorization:`Bearer ${localStorage.getItem("adminToken")}`}),[]),C=r.useCallback(async()=>{try{const t=await u.get("https://rental-platform-0o9d.onrender.com/api/vehicles",{headers:c});f(t.data||[]),h(t.data||[])}catch(t){console.error("Error fetching vehicles:",t),m.error("Failed to load vehicles.")}finally{$(!1)}},[c]);r.useEffect(()=>{C()},[C]);const U=t=>{E(t),h(t==="All Locations"?k:k.filter(a=>a.city===t||a.location?.city===t))},z=async t=>{if(window.confirm("Delete this vehicle?"))try{await u.delete(`https://rental-platform-0o9d.onrender.com/api/vehicles/${t}`,{headers:c}),f(a=>a.filter(s=>s._id!==t)),h(a=>a.filter(s=>s._id!==t)),m.success("Vehicle deleted successfully!")}catch(a){console.error("Error deleting vehicle:",a),m.error("Failed to delete vehicle.")}},Q=t=>{b(t),p({modelName:t.modelName,brand:t.brand,rentPerDay:t.rentPerDay,totalQuantity:t.totalQuantity,city:t.city||t.location?.city||y[1],type:t.type,kmLimitPerDay:t.kmLimitPerDay||150}),D([]),L(t.images||[])},n=t=>{const{name:a,value:s}=t.target;if(["rentPerDay","totalQuantity","kmLimitPerDay"].includes(a)){if(s===""||s==="-"){p({...l,[a]:s});return}const i=Number(s);!isNaN(i)&&i>=0&&p({...l,[a]:i});return}p({...l,[a]:s})},R=t=>{const a=Array.from(t.target.files);D(a),L([...j,...a.map(s=>URL.createObjectURL(s))])},T=async t=>{if(t.preventDefault(),!o)return;const a=new FormData;Object.entries(l).forEach(([s,i])=>{i!=null&&(typeof i=="number"?a.append(s,i.toString()):a.append(s,i))}),F.forEach(s=>a.append("images",s));try{if((await u.put(`https://rental-platform-0o9d.onrender.com/api/vehicles/${o._id}`,a,{headers:{...c,"Content-Type":"multipart/form-data"}})).data?.success){m.success("✅ Vehicle updated successfully!");const P=(await u.get(`https://rental-platform-0o9d.onrender.com/api/vehicles/${o._id}`,{headers:c})).data;f(N=>N.map(x=>x._id===o._id?P:x)),h(N=>N.map(x=>x._id===o._id?P:x)),b(null)}else m.error("❌ Update failed. Please try again.")}catch(s){console.error("Update error:",s),m.error("❌ Server error while updating.")}},B=async t=>{g({open:!0,loading:!0,data:[],vehicle:t});try{const a=await u.get(`https://rental-platform-0o9d.onrender.com/api/bookings/upcoming/${t._id}`,{headers:c}),s=Array.isArray(a.data?.bookings)?a.data.bookings:a.data||[];g({open:!0,loading:!1,data:s,vehicle:t})}catch(a){console.error("Error fetching upcoming bookings:",a),g({open:!0,loading:!1,data:[],vehicle:t,error:!0})}};return V?e.jsxs("div",{className:"flex justify-center items-center min-h-[60vh] text-indigo-600",children:[e.jsx(S,{className:"animate-spin w-6 h-6 mr-2"})," Loading uploaded vehicles..."]}):e.jsxs("div",{className:"bg-white shadow-md rounded-lg p-6 relative",children:[e.jsx(I,{position:"top-center"}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-indigo-600 text-center sm:text-left mb-4 sm:mb-0",children:"Uploaded Vehicles"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(J,{className:"w-5 h-5 text-indigo-600"}),e.jsx("select",{value:A,onChange:t=>U(t.target.value),className:"border border-indigo-300 text-gray-700 rounded-lg p-2 focus:ring-2 focus:ring-indigo-500 focus:outline-none",children:y.map(t=>e.jsx("option",{children:t},t))})]})]}),v.length===0?e.jsx("p",{className:"text-center text-gray-500",children:"No vehicles found for this location."}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:v.map(t=>e.jsxs("div",{className:"border border-gray-200 rounded-xl overflow-hidden hover:shadow-lg transition-shadow bg-white",children:[e.jsx("img",{src:t.images?.[0]||"https://placehold.co/400x200?text=No+Image",alt:t.modelName,className:"w-full h-40 object-cover",loading:"lazy"}),e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"text-lg font-bold text-indigo-700 mb-1",children:t.modelName}),e.jsxs("p",{className:"text-sm text-gray-600 mb-1",children:[t.brand," • ",t.type]}),e.jsxs("p",{className:"flex items-center text-xs text-gray-500 mb-1",children:[e.jsx(q,{className:"w-4 h-4 mr-1 text-red-500"}),t.city||t.location?.city]}),e.jsxs("p",{className:"text-gray-700 text-sm font-semibold",children:["₹",t.rentPerDay," / day"]}),e.jsxs("p",{className:"text-xs text-gray-600 mt-1 flex items-center",children:[e.jsx(O,{className:"w-4 h-4 mr-1 text-sky-500"}),t.kmLimitPerDay?`${t.kmLimitPerDay} km/day`:"150 km/day"]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Available:"," ",e.jsx("span",{className:`font-bold ${t.availableCount>0?"text-green-600":"text-red-600"}`,children:t.availableCount})," ","Total: ",t.totalQuantity]}),e.jsxs("button",{onClick:()=>B(t),className:`mt-3 w-full bg-gradient-to-r from-indigo-500 to-purple-600 hover:from-purple-600 hover:to-indigo-500 
                             text-white py-2 rounded-lg text-sm font-medium flex justify-center items-center gap-2 transition-all`,children:[e.jsx(_,{className:"w-4 h-4"})," View Upcoming Bookings"]}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsxs("button",{onClick:()=>Q(t),className:"w-1/2 bg-indigo-500 text-white py-2 rounded-md hover:bg-indigo-600 transition text-sm flex items-center justify-center",children:[e.jsx(Y,{className:"w-4 h-4 mr-1"})," Edit"]}),e.jsxs("button",{onClick:()=>z(t._id),className:"w-1/2 bg-red-500 text-white py-2 rounded-md hover:bg-red-600 transition text-sm flex items-center justify-center",children:[e.jsx(G,{className:"w-4 h-4 mr-1"})," Delete"]})]})]})]},t._id))}),d.open&&e.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-2xl relative p-6 max-h-[85vh] overflow-y-auto",children:[e.jsx("button",{onClick:()=>g({open:!1,data:[],vehicle:null}),className:"absolute top-3 right-3 text-gray-500 hover:text-gray-700",children:e.jsx(M,{className:"w-5 h-5"})}),e.jsxs("h2",{className:"text-xl font-bold text-indigo-700 mb-3 flex items-center gap-2",children:[e.jsx(_,{className:"w-5 h-5"}),"Upcoming Bookings —"," ",e.jsx("span",{className:"text-gray-700",children:d.vehicle?.modelName})]}),d.loading?e.jsxs("div",{className:"flex justify-center items-center py-10 text-indigo-600",children:[e.jsx(S,{className:"animate-spin w-5 h-5 mr-2"}),"Loading bookings..."]}):d.error?e.jsx("p",{className:"text-red-600 text-center",children:"Error loading bookings."}):d.data.length===0?e.jsx("p",{className:"text-center text-gray-500",children:"No upcoming bookings for this vehicle."}):e.jsx("div",{className:"space-y-2",children:d.data.map(t=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-3 shadow-sm flex justify-between items-center bg-indigo-50",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-indigo-700",children:t.name||"—"}),e.jsx("p",{className:"text-xs text-gray-600",children:t.phoneNumber||"No contact"})]}),e.jsxs("div",{className:"text-xs text-gray-700 text-right",children:[new Date(t.pickupDate).toLocaleDateString()," →"," ",new Date(t.dropoffDate).toLocaleDateString()]})]},t._id))})]})}),o&&e.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-lg relative p-6 max-h-[90vh] overflow-y-auto",children:[e.jsx("button",{onClick:()=>b(null),className:"absolute top-3 right-3 text-gray-500 hover:text-gray-700",children:e.jsx(M,{className:"w-5 h-5"})}),e.jsx("h2",{className:"text-2xl font-bold text-indigo-700 mb-4",children:"Edit Vehicle"}),e.jsxs("form",{onSubmit:T,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Model Name"}),e.jsx("input",{type:"text",name:"modelName",value:l.modelName,onChange:n,className:"border rounded-lg p-2 w-full",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Brand"}),e.jsx("input",{type:"text",name:"brand",value:l.brand,onChange:n,className:"border rounded-lg p-2 w-full",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Rent Per Day (₹)"}),e.jsx("input",{type:"number",name:"rentPerDay",min:"0",value:l.rentPerDay,onChange:n,className:"border rounded-lg p-2 w-full",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Total Quantity"}),e.jsx("input",{type:"number",name:"totalQuantity",min:"0",value:l.totalQuantity,onChange:n,className:"border rounded-lg p-2 w-full",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"City"}),e.jsx("select",{name:"city",value:l.city,onChange:n,className:"border rounded-lg p-2 w-full",children:y.filter(t=>t!=="All Locations").map(t=>e.jsx("option",{children:t},t))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Type"}),e.jsxs("select",{name:"type",value:l.type,onChange:n,className:"border rounded-lg p-2 w-full",children:[e.jsx("option",{value:"bike",children:"Bike"}),e.jsx("option",{value:"scooter",children:"Scooter"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"KM Limit Per Day"}),e.jsx("input",{type:"number",name:"kmLimitPerDay",min:"0",value:l.kmLimitPerDay,onChange:n,className:"border rounded-lg p-2 w-full",placeholder:"e.g. 150",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Upload Images (optional)"}),e.jsx("input",{type:"file",multiple:!0,accept:"image/*",onChange:R,className:"border rounded-lg p-2 w-full"})]}),j.length>0&&e.jsx("div",{className:"grid grid-cols-2 gap-3 mt-2",children:j.map((t,a)=>e.jsx("img",{src:t,alt:`preview-${a}`,className:"w-full h-28 object-cover rounded-md border"},a))}),e.jsxs("button",{type:"submit",className:"w-full bg-indigo-600 text-white py-2 rounded-lg hover:bg-indigo-700 flex items-center justify-center gap-2",children:[e.jsx(H,{className:"w-4 h-4"})," Save Changes"]})]})]})})]})};export{de as default};
